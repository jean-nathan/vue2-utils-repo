# Navigation Guards no Vue Router

## IntroduÃ§Ã£o  
Os **Navigation Guards** (GuardiÃµes de NavegaÃ§Ã£o) sÃ£o mecanismos do Vue Router para interceptar e controlar transiÃ§Ãµes entre rotas. Eles sÃ£o essenciais para:  
- **ValidaÃ§Ã£o de acesso** (ex: autenticaÃ§Ã£o)  
- **PrÃ©-carregamento de dados**  
- **ConfirmaÃ§Ã£o de aÃ§Ãµes** (ex: evitar perda de dados)  

---

## Tipos de Navigation Guards

### 1. GuardiÃµes Globais  
Aplicados a **todas as rotas** via instÃ¢ncia do router (`router.js` ou `main.js`).

```javascript
// main.js
router.beforeEach((to, from, next) => {
  if (to.meta.requiresAuth && !userStore.isLoggedIn) {
    next('/login'); // Redireciona
  } else {
    next(); // Permite navegaÃ§Ã£o
  }
});

router.afterEach((to, from) => {
  analytics.trackPageView(to.name); // Exemplo: rastreamento
});
```

| MÃ©todo         | Quando Ã© Executado?          | Acesso ao `this`? |
|----------------|------------------------------|-------------------|
| `beforeEach`   | Antes da confirmaÃ§Ã£o da rota | âŒ NÃ£o            |
| `afterEach`    | ApÃ³s confirmaÃ§Ã£o da rota     | âŒ NÃ£o            |

---

### 2. GuardiÃµes por Rota  
Definidos diretamente na configuraÃ§Ã£o de uma rota especÃ­fica.

```javascript
// router.js
{
  path: '/dashboard',
  component: Dashboard,
  beforeEnter: (to, from, next) => {
    if (!userHasPermission('admin')) {
      next('/403'); // Redireciona para pÃ¡gina de erro
    } else {
      next();
    }
  }
}
```

---

### 3. GuardiÃµes em Componentes  
Implementados diretamente nos componentes Vue, oferecendo controle granular.

#### Hooks DisponÃ­veis:
```javascript
export default {
  beforeRouteEnter(to, from, next) { /* Antes de entrar */ },
  beforeRouteUpdate(to, from, next) { /* ParÃ¢metros da rota mudaram */ },
  beforeRouteLeave(to, from, next) { /* Antes de sair */ }
}
```

#### âš ï¸ Acessando `this` no `beforeRouteEnter`  
Como o componente ainda nÃ£o foi criado, o `this` nÃ£o estÃ¡ disponÃ­vel. A soluÃ§Ã£o Ã© usar uma **funÃ§Ã£o de callback** no `next()`:

```javascript
beforeRouteEnter(to, from, next) {
  // this.pullData() âŒ Erro! this Ã© undefined
  next((vm) => {
    vm.pullData(); // âœ… Acessa a instÃ¢ncia via 'vm'
  });
},
methods: {
  pullData() {
    console.log('Carregando dados...');
  }
}
```

#### Casos de Uso EspecÃ­ficos:
- **`beforeRouteUpdate`**: Atualizar dados quando parÃ¢metros da URL mudam (ex: `/produto/1` â†’ `/produto/2`).
  ```javascript
  beforeRouteUpdate(to, from, next) {
    this.productId = to.params.id;
    this.fetchProduct();
    next();
  }
  ```

- **`beforeRouteLeave`**: Confirmar saÃ­da de uma pÃ¡gina com formulÃ¡rio nÃ£o salvo.
  ```javascript
  beforeRouteLeave(to, from, next) {
    if (this.formModified) {
      const confirmar = confirm('AlteraÃ§Ãµes nÃ£o salvas! Sair mesmo assim?');
      next(confirmar);
    } else {
      next();
    }
  }
  ```

---

## Fluxo de ExecuÃ§Ã£o dos Guards  
Entenda a ordem de execuÃ§Ã£o:  
1. `beforeRouteLeave` (componente atual)  
2. `beforeEach` (global)  
3. `beforeEnter` (rota de destino)  
4. `beforeRouteEnter` (componente de destino)  
5. `afterEach` (global)  

---

## Melhores PrÃ¡ticas e Armadilhas

### âœ… Quando Usar:
- AutenticaÃ§Ã£o e autorizaÃ§Ã£o
- PrÃ©-fetch de dados (ex: carregar dados de API antes de renderizar)
- ValidaÃ§Ã£o de formulÃ¡rios nÃ£o submetidos

### âŒ Quando Evitar:
- Em rotas pÃºblicas/simples sem lÃ³gica adicional
- Para substituir validaÃ§Ãµes de backend
- Em lÃ³gicas complexas que poluem os guards

---

## Exemplo Completo: ProteÃ§Ã£o de Rota com Vuex
```javascript
// Global Guard (router.js)
router.beforeEach(async (to, from, next) => {
  const requerAutenticacao = to.matched.some(route => route.meta.requiresAuth);
  
  if (requerAutenticacao && !store.getters.isAuthenticated) {
    next({ name: 'Login', query: { redirect: to.fullPath } });
  } else {
    next();
  }
});

// Component Guard (UserProfile.vue)
beforeRouteEnter(to, from, next) {
  next(async (vm) => {
    try {
      await vm.$store.dispatch('fetchUser', to.params.id);
    } catch (error) {
      vm.$router.push('/error');
    }
  });
}
```

---

## ConclusÃ£o  
Dominar os Navigation Guards permite criar aplicaÃ§Ãµes Vue seguras e responsivas. Lembre-se:  
- Use guards globais para regras gerais  
- Guards em componentes para lÃ³gicas especÃ­ficas  
- O callback do `next()` Ã© sua ferramenta para acessar a instÃ¢ncia no `beforeRouteEnter`  
- Sempre combine proteÃ§Ã£o frontend e backend para seguranÃ§a robusta!

---

Ã“timo, Nathan! Vamos deixar **todos os tipos de Navigation Guards** com explicaÃ§Ãµes bem **didÃ¡ticas e diretas**, para facilitar a memorizaÃ§Ã£o e visualizaÃ§Ã£o.

---

# âœ… Tipos de Navigation Guards (Vue Router) â€“ Em que posso usa-los!

---

## ðŸ”µ 1. **GuardiÃµes Globais**

> SÃ£o aplicados **em todas as rotas**, definidos no `main.js` ou `router.js`.

### ðŸ”¹ `beforeEach`

> Executado **antes de qualquer rota carregar**.

**Para quÃª serve?**
ðŸ‘‰ Ideal para **bloquear acesso** (ex: se o usuÃ¡rio nÃ£o estÃ¡ logado).

ðŸ“Œ **Exemplo:**

```javascript
router.beforeEach((to, from, next) => {
  if (to.meta.requiresAuth && !userStore.isLoggedIn) {
    next('/login'); // Redireciona
  } else {
    next(); // Permite continuar
  }
});
```

### ðŸ”¹ `afterEach`

> Executado **depois que a navegaÃ§Ã£o Ã© confirmada**.

**Para quÃª serve?**
ðŸ‘‰ Para **aÃ§Ãµes pÃ³s-navegaÃ§Ã£o**, como rastrear a pÃ¡gina com analytics.

ðŸ“Œ **Exemplo:**

```javascript
router.afterEach((to, from) => {
  analytics.trackPageView(to.fullPath); // Google Analytics ou similar
});
```

---

## ðŸŸ¢ 2. **GuardiÃµes por Rota**

> Definidos **diretamente na configuraÃ§Ã£o da rota**, Ãºteis para regras especÃ­ficas de cada caminho.

**Para quÃª serve?**
ðŸ‘‰ Quando **apenas uma rota** precisa de uma verificaÃ§Ã£o (ex: verificar permissÃ£o de admin).

ðŸ“Œ **Exemplo:**

```javascript
{
  path: '/admin',
  component: AdminPanel,
  beforeEnter: (to, from, next) => {
    if (!userHasPermission('admin')) {
      next('/403'); // PÃ¡gina de acesso negado
    } else {
      next(); // Tudo certo
    }
  }
}
```

---

## ðŸŸ£ 3. **GuardiÃµes em Componentes**

> Colocados **dentro do componente Vue**, dÃ£o controle total sobre o que acontece **na tela atual**.

### ðŸ”¹ `beforeRouteEnter`

> Antes do componente ser criado.

**Para quÃª serve?**
ðŸ‘‰ Carregar dados **antes da tela ser exibida**.

ðŸ“Œ **Exemplo:**

```javascript
beforeRouteEnter(to, from, next) {
  next((vm) => {
    vm.fetchUser(to.params.id); // Agora o componente existe
  });
}
```

---

### ðŸ”¹ `beforeRouteUpdate`

> Executado quando **a rota muda**, mas o componente **permanece na tela** (como `produto/1 â†’ produto/2`).

**Para quÃª serve?**
ðŸ‘‰ Atualizar os dados do componente **sem recarregar a pÃ¡gina**.

ðŸ“Œ **Exemplo:**

```javascript
beforeRouteUpdate(to, from, next) {
  this.productId = to.params.id;
  this.fetchProduct(); // Carrega novo produto
  next();
}
```

---

### ðŸ”¹ `beforeRouteLeave`

> Executado **antes de sair da tela atual**.

**Para quÃª serve?**
ðŸ‘‰ Confirmar se o usuÃ¡rio pode sair (ex: dados nÃ£o salvos no formulÃ¡rio).

ðŸ“Œ **Exemplo:**

```javascript
beforeRouteLeave(to, from, next) {
  if (this.dadosNaoSalvos) {
    const podeSair = confirm('Deseja sair sem salvar?');
    next(podeSair); // true ou false
  } else {
    next(); // Pode sair normalmente
  }
}
```

---

## ðŸ“Š Resumo Geral

| Tipo de Guard       | Onde Ã© usado? | Quando Ã© chamado?                              | Para quÃª serve?                        |
| ------------------- | ------------- | ---------------------------------------------- | -------------------------------------- |
| `beforeEach`        | Global        | Antes de entrar em qualquer rota               | Verificar autenticaÃ§Ã£o                 |
| `afterEach`         | Global        | Depois de entrar na rota                       | AÃ§Ãµes pÃ³s-navegaÃ§Ã£o                    |
| `beforeEnter`       | Por rota      | Antes de entrar em uma rota especÃ­fica         | VerificaÃ§Ã£o por rota                   |
| `beforeRouteEnter`  | Componente    | Antes do componente ser criado                 | Buscar dados antes de exibir           |
| `beforeRouteUpdate` | Componente    | Quando a rota muda, mas o componente permanece | Atualizar dados dinamicamente          |
| `beforeRouteLeave`  | Componente    | Antes de sair do componente atual              | Confirmar saÃ­da (ex: dados nÃ£o salvos) |

---
